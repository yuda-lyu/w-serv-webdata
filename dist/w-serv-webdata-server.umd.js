/*!
 * w-serv-webdata-server v1.0.86
 * (c) 2018-2021 yuda-lyu(semisphere)
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("fs")):"function"==typeof define&&define.amd?define(["fs"],e):(t="undefined"!=typeof globalThis?globalThis:t||self)["w-serv-webdata-server"]=e(t.fs)}(this,(function(t){"use strict";var e=Array.isArray,r="object"==typeof global&&global&&global.Object===Object&&global,n="object"==typeof self&&self&&self.Object===Object&&self,o=r||n||Function("return this")(),i=o.Symbol,u=Object.prototype,a=u.hasOwnProperty,c=u.toString,s=i?i.toStringTag:void 0;var f=Object.prototype.toString;var l="[object Null]",v="[object Undefined]",h=i?i.toStringTag:void 0;function p(t){return null==t?void 0===t?v:l:h&&h in Object(t)?function(t){var e=a.call(t,s),r=t[s];try{t[s]=void 0;var n=!0}catch(t){}var o=c.call(t);return n&&(e?t[s]=r:delete t[s]),o}(t):function(t){return f.call(t)}(t)}function d(t){return null!=t&&"object"==typeof t}var y="[object Symbol]";function b(t){return"symbol"==typeof t||d(t)&&p(t)==y}var g=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,j=/^\w*$/;function _(t,r){if(e(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!b(t))||(j.test(t)||!g.test(t)||null!=r&&t in Object(r))}function m(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var w="[object AsyncFunction]",O="[object Function]",$="[object GeneratorFunction]",S="[object Proxy]";function T(t){if(!m(t))return!1;var e=p(t);return e==O||e==$||e==w||e==S}var x,A=o["__core-js_shared__"],M=(x=/[^.]+$/.exec(A&&A.keys&&A.keys.IE_PROTO||""))?"Symbol(src)_1."+x:"";var D=Function.prototype.toString;function E(t){if(null!=t){try{return D.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var k=/^\[object .+?Constructor\]$/,I=Function.prototype,C=Object.prototype,F=I.toString,z=C.hasOwnProperty,N=RegExp("^"+F.call(z).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function P(t){return!(!m(t)||(e=t,M&&M in e))&&(T(t)?N:k).test(E(t));var e}function W(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return P(r)?r:void 0}var L=W(Object,"create");var U=Object.prototype.hasOwnProperty;var B=Object.prototype.hasOwnProperty;function Y(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function H(t,e){return t===e||t!=t&&e!=e}function V(t,e){for(var r=t.length;r--;)if(H(t[r][0],e))return r;return-1}Y.prototype.clear=function(){this.__data__=L?L(null):{},this.size=0},Y.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Y.prototype.get=function(t){var e=this.__data__;if(L){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return U.call(e,t)?e[t]:void 0},Y.prototype.has=function(t){var e=this.__data__;return L?void 0!==e[t]:B.call(e,t)},Y.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=L&&void 0===e?"__lodash_hash_undefined__":e,this};var R=Array.prototype.splice;function J(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}J.prototype.clear=function(){this.__data__=[],this.size=0},J.prototype.delete=function(t){var e=this.__data__,r=V(e,t);return!(r<0)&&(r==e.length-1?e.pop():R.call(e,r,1),--this.size,!0)},J.prototype.get=function(t){var e=this.__data__,r=V(e,t);return r<0?void 0:e[r][1]},J.prototype.has=function(t){return V(this.__data__,t)>-1},J.prototype.set=function(t,e){var r=this.__data__,n=V(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};var Z=W(o,"Map");function q(t,e){var r,n,o=t.__data__;return("string"==(n=typeof(r=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof e?"string":"hash"]:o.map}function G(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}G.prototype.clear=function(){this.size=0,this.__data__={hash:new Y,map:new(Z||J),string:new Y}},G.prototype.delete=function(t){var e=q(this,t).delete(t);return this.size-=e?1:0,e},G.prototype.get=function(t){return q(this,t).get(t)},G.prototype.has=function(t){return q(this,t).has(t)},G.prototype.set=function(t,e){var r=q(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};var K="Expected a function";function Q(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(K);var r=function(){var n=arguments,o=e?e.apply(this,n):n[0],i=r.cache;if(i.has(o))return i.get(o);var u=t.apply(this,n);return r.cache=i.set(o,u)||i,u};return r.cache=new(Q.Cache||G),r}Q.Cache=G;var X,tt,et,rt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,nt=/\\(\\)?/g,ot=(X=function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(rt,(function(t,r,n,o){e.push(n?o.replace(nt,"$1"):r||t)})),e},tt=Q(X,(function(t){return 500===et.size&&et.clear(),t})),et=tt.cache,tt),it=ot;function ut(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o}var at=1/0,ct=i?i.prototype:void 0,st=ct?ct.toString:void 0;function ft(t){if("string"==typeof t)return t;if(e(t))return ut(t,ft)+"";if(b(t))return st?st.call(t):"";var r=t+"";return"0"==r&&1/t==-at?"-0":r}function lt(t){return null==t?"":ft(t)}function vt(t,r){return e(t)?t:_(t,r)?[t]:it(lt(t))}var ht=1/0;function pt(t){if("string"==typeof t||b(t))return t;var e=t+"";return"0"==e&&1/t==-ht?"-0":e}function dt(t,e){for(var r=0,n=(e=vt(e,t)).length;null!=t&&r<n;)t=t[pt(e[r++])];return r&&r==n?t:void 0}function yt(t,e,r){var n=null==t?void 0:dt(t,e);return void 0===n?r:n}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var bt={};!function(t){var e=Object.prototype.hasOwnProperty,r="~";function n(){}function o(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function i(t,e,n,i,u){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new o(n,i||t,u),c=r?r+e:e;return t._events[c]?t._events[c].fn?t._events[c]=[t._events[c],a]:t._events[c].push(a):(t._events[c]=a,t._eventsCount++),t}function u(t,e){0==--t._eventsCount?t._events=new n:delete t._events[e]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),a.prototype.eventNames=function(){var t,n,o=[];if(0===this._eventsCount)return o;for(n in t=this._events)e.call(t,n)&&o.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(t)):o},a.prototype.listeners=function(t){var e=r?r+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,i=n.length,u=new Array(i);o<i;o++)u[o]=n[o].fn;return u},a.prototype.listenerCount=function(t){var e=r?r+t:t,n=this._events[e];return n?n.fn?1:n.length:0},a.prototype.emit=function(t,e,n,o,i,u){var a=r?r+t:t;if(!this._events[a])return!1;var c,s,f=this._events[a],l=arguments.length;if(f.fn){switch(f.once&&this.removeListener(t,f.fn,void 0,!0),l){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,e),!0;case 3:return f.fn.call(f.context,e,n),!0;case 4:return f.fn.call(f.context,e,n,o),!0;case 5:return f.fn.call(f.context,e,n,o,i),!0;case 6:return f.fn.call(f.context,e,n,o,i,u),!0}for(s=1,c=new Array(l-1);s<l;s++)c[s-1]=arguments[s];f.fn.apply(f.context,c)}else{var v,h=f.length;for(s=0;s<h;s++)switch(f[s].once&&this.removeListener(t,f[s].fn,void 0,!0),l){case 1:f[s].fn.call(f[s].context);break;case 2:f[s].fn.call(f[s].context,e);break;case 3:f[s].fn.call(f[s].context,e,n);break;case 4:f[s].fn.call(f[s].context,e,n,o);break;default:if(!c)for(v=1,c=new Array(l-1);v<l;v++)c[v-1]=arguments[v];f[s].fn.apply(f[s].context,c)}}return!0},a.prototype.on=function(t,e,r){return i(this,t,e,r,!1)},a.prototype.once=function(t,e,r){return i(this,t,e,r,!0)},a.prototype.removeListener=function(t,e,n,o){var i=r?r+t:t;if(!this._events[i])return this;if(!e)return u(this,i),this;var a=this._events[i];if(a.fn)a.fn!==e||o&&!a.once||n&&a.context!==n||u(this,i);else{for(var c=0,s=[],f=a.length;c<f;c++)(a[c].fn!==e||o&&!a[c].once||n&&a[c].context!==n)&&s.push(a[c]);s.length?this._events[i]=1===s.length?s[0]:s:u(this,i)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&u(this,e)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,t.exports=a}({get exports(){return bt},set exports(t){bt=t}});var gt=bt;function jt(){return new gt}function _t(t){return"[object Object]"===Object.prototype.toString.call(t)}function mt(t){return"[object String]"===Object.prototype.toString.call(t)}function wt(t){return!(!mt(t)||""===t)}function Ot(t){return t!=t}function $t(t){let e=!1;if(wt(t))e=!isNaN(Number(t));else if(function(t){return"[object Number]"===Object.prototype.toString.call(t)}(t)){if(Ot(t))return!1;e=!0}return e}function St(t,e){return!!_t(t)&&(!(!wt(e)&&!$t(e))&&e in t)}var Tt={};!function(t,e){t.exports=function(){var t=1e3,e=6e4,r=36e5,n="millisecond",o="second",i="minute",u="hour",a="day",c="week",s="month",f="quarter",l="year",v="date",h="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,d=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,y={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(t){var e=["th","st","nd","rd"],r=t%100;return"["+t+(e[(r-20)%10]||e[r]||e[0])+"]"}},b=function(t,e,r){var n=String(t);return!n||n.length>=e?t:""+Array(e+1-n.length).join(r)+t},g={s:b,z:function(t){var e=-t.utcOffset(),r=Math.abs(e),n=Math.floor(r/60),o=r%60;return(e<=0?"+":"-")+b(n,2,"0")+":"+b(o,2,"0")},m:function t(e,r){if(e.date()<r.date())return-t(r,e);var n=12*(r.year()-e.year())+(r.month()-e.month()),o=e.clone().add(n,s),i=r-o<0,u=e.clone().add(n+(i?-1:1),s);return+(-(n+(r-o)/(i?o-u:u-o))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(t){return{M:s,y:l,w:c,d:a,D:v,h:u,m:i,s:o,ms:n,Q:f}[t]||String(t||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},j="en",_={};_[j]=y;var m="$isDayjsObject",w=function(t){return t instanceof T||!(!t||!t[m])},O=function t(e,r,n){var o;if(!e)return j;if("string"==typeof e){var i=e.toLowerCase();_[i]&&(o=i),r&&(_[i]=r,o=i);var u=e.split("-");if(!o&&u.length>1)return t(u[0])}else{var a=e.name;_[a]=e,o=a}return!n&&o&&(j=o),o||!n&&j},$=function(t,e){if(w(t))return t.clone();var r="object"==typeof e?e:{};return r.date=t,r.args=arguments,new T(r)},S=g;S.l=O,S.i=w,S.w=function(t,e){return $(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var T=function(){function y(t){this.$L=O(t.locale,null,!0),this.parse(t),this.$x=this.$x||t.x||{},this[m]=!0}var b=y.prototype;return b.parse=function(t){this.$d=function(t){var e=t.date,r=t.utc;if(null===e)return new Date(NaN);if(S.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var n=e.match(p);if(n){var o=n[2]-1||0,i=(n[7]||"0").substring(0,3);return r?new Date(Date.UTC(n[1],o,n[3]||1,n[4]||0,n[5]||0,n[6]||0,i)):new Date(n[1],o,n[3]||1,n[4]||0,n[5]||0,n[6]||0,i)}}return new Date(e)}(t),this.init()},b.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},b.$utils=function(){return S},b.isValid=function(){return!(this.$d.toString()===h)},b.isSame=function(t,e){var r=$(t);return this.startOf(e)<=r&&r<=this.endOf(e)},b.isAfter=function(t,e){return $(t)<this.startOf(e)},b.isBefore=function(t,e){return this.endOf(e)<$(t)},b.$g=function(t,e,r){return S.u(t)?this[e]:this.set(r,t)},b.unix=function(){return Math.floor(this.valueOf()/1e3)},b.valueOf=function(){return this.$d.getTime()},b.startOf=function(t,e){var r=this,n=!!S.u(e)||e,f=S.p(t),h=function(t,e){var o=S.w(r.$u?Date.UTC(r.$y,e,t):new Date(r.$y,e,t),r);return n?o:o.endOf(a)},p=function(t,e){return S.w(r.toDate()[t].apply(r.toDate("s"),(n?[0,0,0,0]:[23,59,59,999]).slice(e)),r)},d=this.$W,y=this.$M,b=this.$D,g="set"+(this.$u?"UTC":"");switch(f){case l:return n?h(1,0):h(31,11);case s:return n?h(1,y):h(0,y+1);case c:var j=this.$locale().weekStart||0,_=(d<j?d+7:d)-j;return h(n?b-_:b+(6-_),y);case a:case v:return p(g+"Hours",0);case u:return p(g+"Minutes",1);case i:return p(g+"Seconds",2);case o:return p(g+"Milliseconds",3);default:return this.clone()}},b.endOf=function(t){return this.startOf(t,!1)},b.$set=function(t,e){var r,c=S.p(t),f="set"+(this.$u?"UTC":""),h=(r={},r[a]=f+"Date",r[v]=f+"Date",r[s]=f+"Month",r[l]=f+"FullYear",r[u]=f+"Hours",r[i]=f+"Minutes",r[o]=f+"Seconds",r[n]=f+"Milliseconds",r)[c],p=c===a?this.$D+(e-this.$W):e;if(c===s||c===l){var d=this.clone().set(v,1);d.$d[h](p),d.init(),this.$d=d.set(v,Math.min(this.$D,d.daysInMonth())).$d}else h&&this.$d[h](p);return this.init(),this},b.set=function(t,e){return this.clone().$set(t,e)},b.get=function(t){return this[S.p(t)]()},b.add=function(n,f){var v,h=this;n=Number(n);var p=S.p(f),d=function(t){var e=$(h);return S.w(e.date(e.date()+Math.round(t*n)),h)};if(p===s)return this.set(s,this.$M+n);if(p===l)return this.set(l,this.$y+n);if(p===a)return d(1);if(p===c)return d(7);var y=(v={},v[i]=e,v[u]=r,v[o]=t,v)[p]||1,b=this.$d.getTime()+n*y;return S.w(b,this)},b.subtract=function(t,e){return this.add(-1*t,e)},b.format=function(t){var e=this,r=this.$locale();if(!this.isValid())return r.invalidDate||h;var n=t||"YYYY-MM-DDTHH:mm:ssZ",o=S.z(this),i=this.$H,u=this.$m,a=this.$M,c=r.weekdays,s=r.months,f=r.meridiem,l=function(t,r,o,i){return t&&(t[r]||t(e,n))||o[r].slice(0,i)},v=function(t){return S.s(i%12||12,t,"0")},p=f||function(t,e,r){var n=t<12?"AM":"PM";return r?n.toLowerCase():n};return n.replace(d,(function(t,n){return n||function(t){switch(t){case"YY":return String(e.$y).slice(-2);case"YYYY":return S.s(e.$y,4,"0");case"M":return a+1;case"MM":return S.s(a+1,2,"0");case"MMM":return l(r.monthsShort,a,s,3);case"MMMM":return l(s,a);case"D":return e.$D;case"DD":return S.s(e.$D,2,"0");case"d":return String(e.$W);case"dd":return l(r.weekdaysMin,e.$W,c,2);case"ddd":return l(r.weekdaysShort,e.$W,c,3);case"dddd":return c[e.$W];case"H":return String(i);case"HH":return S.s(i,2,"0");case"h":return v(1);case"hh":return v(2);case"a":return p(i,u,!0);case"A":return p(i,u,!1);case"m":return String(u);case"mm":return S.s(u,2,"0");case"s":return String(e.$s);case"ss":return S.s(e.$s,2,"0");case"SSS":return S.s(e.$ms,3,"0");case"Z":return o}return null}(t)||o.replace(":","")}))},b.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},b.diff=function(n,v,h){var p,d=this,y=S.p(v),b=$(n),g=(b.utcOffset()-this.utcOffset())*e,j=this-b,_=function(){return S.m(d,b)};switch(y){case l:p=_()/12;break;case s:p=_();break;case f:p=_()/3;break;case c:p=(j-g)/6048e5;break;case a:p=(j-g)/864e5;break;case u:p=j/r;break;case i:p=j/e;break;case o:p=j/t;break;default:p=j}return h?p:S.a(p)},b.daysInMonth=function(){return this.endOf(s).$D},b.$locale=function(){return _[this.$L]},b.locale=function(t,e){if(!t)return this.$L;var r=this.clone(),n=O(t,e,!0);return n&&(r.$L=n),r},b.clone=function(){return S.w(this.$d,this)},b.toDate=function(){return new Date(this.valueOf())},b.toJSON=function(){return this.isValid()?this.toISOString():null},b.toISOString=function(){return this.$d.toISOString()},b.toString=function(){return this.$d.toUTCString()},y}(),x=T.prototype;return $.prototype=x,[["$ms",n],["$s",o],["$m",i],["$H",u],["$W",a],["$M",s],["$y",l],["$D",v]].forEach((function(t){x[t[1]]=function(e){return this.$g(e,t[0],t[1])}})),$.extend=function(t,e){return t.$i||(t(e,T,$),t.$i=!0),$},$.locale=O,$.isDayjs=w,$.unix=function(t){return $(1e3*t)},$.en=_[j],$.Ls=_,$.p={},$}()}({get exports(){return Tt},set exports(t){Tt=t}});var xt=Tt;function At(t){let e=Object.prototype.toString.call(t);return"[object Function]"===e||"[object AsyncFunction]"===e}function Mt(){if(!At(xt))throw new Error("invalid dayjs");return xt().format("YYYY-MM-DDTHH:mm:ssZ")}var Dt=/\s/;var Et=/^\s+/;function kt(t){return t?t.slice(0,function(t){for(var e=t.length;e--&&Dt.test(t.charAt(e)););return e}(t)+1).replace(Et,""):t}var It=NaN,Ct=/^[-+]0x[0-9a-f]+$/i,Ft=/^0b[01]+$/i,zt=/^0o[0-7]+$/i,Nt=parseInt;function Pt(t){if("number"==typeof t)return t;if(b(t))return It;if(m(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=m(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=kt(t);var r=Ft.test(t);return r||zt.test(t)?Nt(t.slice(2),r?2:8):Ct.test(t)?It:+t}var Wt=1/0,Lt=17976931348623157e292;function Ut(t){return t?(t=Pt(t))===Wt||t===-Wt?(t<0?-1:1)*Lt:t==t?t:0:0===t?t:0}function Bt(t){var e=Ut(t),r=e%1;return e==e?r?e-r:e:0}function Yt(t){if(!$t(t))return 0;return Ut(t)}function Ht(t){return!!$t(t)&&(t=Yt(t),"number"==typeof(e=t)&&e==Bt(e));var e}var Vt=o.isFinite,Rt=Math.min;var Jt=function(t){var e=Math[t];return function(t,r){if(t=Pt(t),(r=null==r?0:Rt(Bt(r),292))&&Vt(t)){var n=(lt(t)+"e").split("e");return+((n=(lt(e(n[0]+"e"+(+n[1]+r)))+"e").split("e"))[0]+"e"+(+n[1]-r))}return e(t)}}("round"),Zt=Jt;function qt(t){if(!$t(t))return 0;t=Yt(t);let e=Zt(t);return"0"===String(e)?0:e}function Gt(t){if(!Ht(t))return!1;return qt(t)>0}let Kt="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),Qt=Kt.length;function Xt(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,e=[];t=Gt(t)?qt(t):32;for(let r=0;r<t;r++)e[r]=Kt[0|Math.random()*Qt];return e.join("")}function te(t){if(_t(t)){for(let e in t)return!0;return!1}return!1}var ee="[object Boolean]";function re(t){return!0===(e=t)||!1===e||d(e)&&p(e)==ee;var e}var ne=function(){return o.Date.now()},oe="Expected a function",ie=Math.max,ue=Math.min;function ae(t,e,r){var n,o,i,u,a,c,s=0,f=!1,l=!1,v=!0;if("function"!=typeof t)throw new TypeError(oe);function h(e){var r=n,i=o;return n=o=void 0,s=e,u=t.apply(i,r)}function p(t){var r=t-c;return void 0===c||r>=e||r<0||l&&t-s>=i}function d(){var t=ne();if(p(t))return y(t);a=setTimeout(d,function(t){var r=e-(t-c);return l?ue(r,i-(t-s)):r}(t))}function y(t){return a=void 0,v&&n?h(t):(n=o=void 0,u)}function b(){var t=ne(),r=p(t);if(n=arguments,o=this,c=t,r){if(void 0===a)return function(t){return s=t,a=setTimeout(d,e),f?h(t):u}(c);if(l)return clearTimeout(a),a=setTimeout(d,e),h(c)}return void 0===a&&(a=setTimeout(d,e)),u}return e=Pt(e)||0,m(r)&&(f=!!r.leading,i=(l="maxWait"in r)?ie(Pt(r.maxWait)||0,e):i,v="trailing"in r?!!r.trailing:v),b.cancel=function(){void 0!==a&&clearTimeout(a),s=0,n=c=o=a=void 0},b.flush=function(){return void 0===a?u:y(ne())},b}function ce(t){var e=this.__data__=new J(t);this.size=e.size}ce.prototype.clear=function(){this.__data__=new J,this.size=0},ce.prototype.delete=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},ce.prototype.get=function(t){return this.__data__.get(t)},ce.prototype.has=function(t){return this.__data__.has(t)},ce.prototype.set=function(t,e){var r=this.__data__;if(r instanceof J){var n=r.__data__;if(!Z||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new G(n)}return r.set(t,e),this.size=r.size,this};var se=function(){try{var t=W(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),fe=se;function le(t,e,r){"__proto__"==e&&fe?fe(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}function ve(t,e,r){(void 0!==r&&!H(t[e],r)||void 0===r&&!(e in t))&&le(t,e,r)}var he,pe=function(t,e,r){for(var n=-1,o=Object(t),i=r(t),u=i.length;u--;){var a=i[he?u:++n];if(!1===e(o[a],a,o))break}return t},de="object"==typeof exports&&exports&&!exports.nodeType&&exports,ye=de&&"object"==typeof module&&module&&!module.nodeType&&module,be=ye&&ye.exports===de?o.Buffer:void 0,ge=be?be.allocUnsafe:void 0;function je(t,e){if(e)return t.slice();var r=t.length,n=ge?ge(r):new t.constructor(r);return t.copy(n),n}var _e=o.Uint8Array;function me(t){var e=new t.constructor(t.byteLength);return new _e(e).set(new _e(t)),e}function we(t,e){var r=e?me(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}function Oe(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}var $e=Object.create,Se=function(){function t(){}return function(e){if(!m(e))return{};if($e)return $e(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}(),Te=Se;function xe(t,e){return function(r){return t(e(r))}}var Ae=xe(Object.getPrototypeOf,Object),Me=Object.prototype;function De(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Me)}function Ee(t){return"function"!=typeof t.constructor||De(t)?{}:Te(Ae(t))}function ke(t){return d(t)&&"[object Arguments]"==p(t)}var Ie=Object.prototype,Ce=Ie.hasOwnProperty,Fe=Ie.propertyIsEnumerable,ze=ke(function(){return arguments}())?ke:function(t){return d(t)&&Ce.call(t,"callee")&&!Fe.call(t,"callee")},Ne=ze,Pe=9007199254740991;function We(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=Pe}function Le(t){return null!=t&&We(t.length)&&!T(t)}var Ue="object"==typeof exports&&exports&&!exports.nodeType&&exports,Be=Ue&&"object"==typeof module&&module&&!module.nodeType&&module,Ye=Be&&Be.exports===Ue?o.Buffer:void 0,He=(Ye?Ye.isBuffer:void 0)||function(){return!1},Ve="[object Object]",Re=Function.prototype,Je=Object.prototype,Ze=Re.toString,qe=Je.hasOwnProperty,Ge=Ze.call(Object);var Ke={};function Qe(t){return function(e){return t(e)}}Ke["[object Float32Array]"]=Ke["[object Float64Array]"]=Ke["[object Int8Array]"]=Ke["[object Int16Array]"]=Ke["[object Int32Array]"]=Ke["[object Uint8Array]"]=Ke["[object Uint8ClampedArray]"]=Ke["[object Uint16Array]"]=Ke["[object Uint32Array]"]=!0,Ke["[object Arguments]"]=Ke["[object Array]"]=Ke["[object ArrayBuffer]"]=Ke["[object Boolean]"]=Ke["[object DataView]"]=Ke["[object Date]"]=Ke["[object Error]"]=Ke["[object Function]"]=Ke["[object Map]"]=Ke["[object Number]"]=Ke["[object Object]"]=Ke["[object RegExp]"]=Ke["[object Set]"]=Ke["[object String]"]=Ke["[object WeakMap]"]=!1;var Xe="object"==typeof exports&&exports&&!exports.nodeType&&exports,tr=Xe&&"object"==typeof module&&module&&!module.nodeType&&module,er=tr&&tr.exports===Xe&&r.process,rr=function(){try{var t=tr&&tr.require&&tr.require("util").types;return t||er&&er.binding&&er.binding("util")}catch(t){}}(),nr=rr&&rr.isTypedArray,or=nr?Qe(nr):function(t){return d(t)&&We(t.length)&&!!Ke[p(t)]};function ir(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}var ur=Object.prototype.hasOwnProperty;function ar(t,e,r){var n=t[e];ur.call(t,e)&&H(n,r)&&(void 0!==r||e in t)||le(t,e,r)}function cr(t,e,r,n){var o=!r;r||(r={});for(var i=-1,u=e.length;++i<u;){var a=e[i],c=n?n(r[a],t[a],a,r,t):void 0;void 0===c&&(c=t[a]),o?le(r,a,c):ar(r,a,c)}return r}var sr=9007199254740991,fr=/^(?:0|[1-9]\d*)$/;function lr(t,e){var r=typeof t;return!!(e=null==e?sr:e)&&("number"==r||"symbol"!=r&&fr.test(t))&&t>-1&&t%1==0&&t<e}var vr=Object.prototype.hasOwnProperty;function hr(t,r){var n=e(t),o=!n&&Ne(t),i=!n&&!o&&He(t),u=!n&&!o&&!i&&or(t),a=n||o||i||u,c=a?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],s=c.length;for(var f in t)!r&&!vr.call(t,f)||a&&("length"==f||i&&("offset"==f||"parent"==f)||u&&("buffer"==f||"byteLength"==f||"byteOffset"==f)||lr(f,s))||c.push(f);return c}var pr=Object.prototype.hasOwnProperty;function dr(t){if(!m(t))return function(t){var e=[];if(null!=t)for(var r in Object(t))e.push(r);return e}(t);var e=De(t),r=[];for(var n in t)("constructor"!=n||!e&&pr.call(t,n))&&r.push(n);return r}function yr(t){return Le(t)?hr(t,!0):dr(t)}function br(t,r,n,o,i,u,a){var c=ir(t,n),s=ir(r,n),f=a.get(s);if(f)ve(t,n,f);else{var l,v=u?u(c,s,n+"",t,r,a):void 0,h=void 0===v;if(h){var y=e(s),b=!y&&He(s),g=!y&&!b&&or(s);v=s,y||b||g?e(c)?v=c:d(l=c)&&Le(l)?v=Oe(c):b?(h=!1,v=je(s,!0)):g?(h=!1,v=we(s,!0)):v=[]:function(t){if(!d(t)||p(t)!=Ve)return!1;var e=Ae(t);if(null===e)return!0;var r=qe.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&Ze.call(r)==Ge}(s)||Ne(s)?(v=c,Ne(c)?v=function(t){return cr(t,yr(t))}(c):m(c)&&!T(c)||(v=Ee(s))):h=!1}h&&(a.set(s,v),i(v,s,o,u,a),a.delete(s)),ve(t,n,v)}}function gr(t,e,r,n,o){t!==e&&pe(e,(function(i,u){if(o||(o=new ce),m(i))br(t,e,u,r,gr,n,o);else{var a=n?n(ir(t,u),i,u+"",t,e,o):void 0;void 0===a&&(a=i),ve(t,u,a)}}),yr)}function jr(t){return t}var _r=Math.max;var mr=fe?function(t,e){return fe(t,"toString",{configurable:!0,enumerable:!1,value:(r=e,function(){return r}),writable:!0});var r}:jr,wr=mr,Or=Date.now;var $r=function(t){var e=0,r=0;return function(){var n=Or(),o=16-(n-r);if(r=n,o>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}(wr),Sr=$r;function Tr(t,e){return Sr(function(t,e,r){return e=_r(void 0===e?t.length-1:e,0),function(){for(var n=arguments,o=-1,i=_r(n.length-e,0),u=Array(i);++o<i;)u[o]=n[e+o];o=-1;for(var a=Array(e+1);++o<e;)a[o]=n[o];return a[e]=r(u),function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}(t,this,a)}}(t,e,jr),t+"")}var xr,Ar=(xr=function(t,e,r){gr(t,e,r)},Tr((function(t,e){var r=-1,n=e.length,o=n>1?e[n-1]:void 0,i=n>2?e[2]:void 0;for(o=xr.length>3&&"function"==typeof o?(n--,o):void 0,i&&function(t,e,r){if(!m(r))return!1;var n=typeof e;return!!("number"==n?Le(r)&&lr(e,r.length):"string"==n&&e in r)&&H(r[e],t)}(e[0],e[1],i)&&(o=n<3?void 0:o,n=1),t=Object(t);++r<n;){var u=e[r];u&&xr(t,u,r,o)}return t})));function Mr(t){return"[object Undefined]"===Object.prototype.toString.call(t)}function Dr(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={};if(te(e)||(console.log("instWConverServer is not an effective object, and set instWConverServer to an EventEmitter"),e=jt()),!St(e,"emit"))throw new Error("instWConverServer is not an EventEmitter");let o=yt(r,"fpTableTags","");wt(o)||(o="./tableTags.json");let i=yt(r,"genTag");At(i)||(i=()=>Mt()+"|"+Xt(6));let u=function(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];setTimeout((()=>{e.emit(t,...n)}),1)};function a(){let e={};try{if(t.existsSync(o)){let r=function(t){if(!wt(t))return{};let e={};try{e=JSON.parse(t)}catch(t){e={}}return e}(t.readFileSync(o,"utf8"));te(r)&&(e=r)}}catch(t){u("error",{msg:"readTableTags catch",err:t})}return e}function c(){try{let e=function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Mr(t))return"";let r="";try{r=e?JSON.stringify(t,null,2):JSON.stringify(t)}catch(t){r=""}return r}(n);t.writeFileSync(o,e,"utf8")}catch(t){u("error",{msg:"writeTableTags catch",err:t})}}let s=ae((()=>{c(),u("changeTableTags",n)}),200);return e.readTableTags=a,e.writeTableTags=c,e.initTableTags=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"useInputFirst";if("useInputOnly"===e)n=t;else if("useStorageOnly"===e)n=a();else if("useInputFirst"===e)n=Ar(a(),t);else{if("useStorageFirst"!==e)throw new Error(`invalid mode[${e}]`);n=Ar(t,a())}c()},e.setTableTags=function(){n=Ar(n,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),c()},e.getTableTags=function(){return n},e.updateTableTag=function(t){n[t]=i(),s()},e}function Er(t,e){for(var r=-1,n=null==t?0:t.length;++r<n&&!1!==e(t[r],r,t););return t}var kr=xe(Object.keys,Object),Ir=Object.prototype.hasOwnProperty;function Cr(t){if(!De(t))return kr(t);var e=[];for(var r in Object(t))Ir.call(t,r)&&"constructor"!=r&&e.push(r);return e}function Fr(t){return Le(t)?hr(t):Cr(t)}var zr=function(t,e){return function(r,n){if(null==r)return r;if(!Le(r))return t(r,n);for(var o=r.length,i=e?o:-1,u=Object(r);(e?i--:++i<o)&&!1!==n(u[i],i,u););return r}}((function(t,e){return t&&pe(t,e,Fr)})),Nr=zr;function Pr(t,r){var n;return(e(t)?Er:Nr)(t,"function"==typeof(n=r)?n:jr)}function Wr(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new G;++e<r;)this.add(t[e])}function Lr(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}function Ur(t,e){return t.has(e)}Wr.prototype.add=Wr.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},Wr.prototype.has=function(t){return this.__data__.has(t)};var Br=1,Yr=2;function Hr(t,e,r,n,o,i){var u=r&Br,a=t.length,c=e.length;if(a!=c&&!(u&&c>a))return!1;var s=i.get(t),f=i.get(e);if(s&&f)return s==e&&f==t;var l=-1,v=!0,h=r&Yr?new Wr:void 0;for(i.set(t,e),i.set(e,t);++l<a;){var p=t[l],d=e[l];if(n)var y=u?n(d,p,l,e,t,i):n(p,d,l,t,e,i);if(void 0!==y){if(y)continue;v=!1;break}if(h){if(!Lr(e,(function(t,e){if(!Ur(h,e)&&(p===t||o(p,t,r,n,i)))return h.push(e)}))){v=!1;break}}else if(p!==d&&!o(p,d,r,n,i)){v=!1;break}}return i.delete(t),i.delete(e),v}function Vr(t){var e=-1,r=Array(t.size);return t.forEach((function(t,n){r[++e]=[n,t]})),r}function Rr(t){var e=-1,r=Array(t.size);return t.forEach((function(t){r[++e]=t})),r}var Jr=1,Zr=2,qr="[object Boolean]",Gr="[object Date]",Kr="[object Error]",Qr="[object Map]",Xr="[object Number]",tn="[object RegExp]",en="[object Set]",rn="[object String]",nn="[object Symbol]",on="[object ArrayBuffer]",un="[object DataView]",an=i?i.prototype:void 0,cn=an?an.valueOf:void 0;function sn(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t}function fn(t,r,n){var o=r(t);return e(t)?o:sn(o,n(t))}function ln(){return[]}var vn=Object.prototype.propertyIsEnumerable,hn=Object.getOwnPropertySymbols,pn=hn?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,i=[];++r<n;){var u=t[r];e(u,r,t)&&(i[o++]=u)}return i}(hn(t),(function(e){return vn.call(t,e)})))}:ln,dn=pn;function yn(t){return fn(t,Fr,dn)}var bn=1,gn=Object.prototype.hasOwnProperty;var jn=W(o,"DataView"),_n=W(o,"Promise"),mn=W(o,"Set"),wn=W(o,"WeakMap"),On="[object Map]",$n="[object Promise]",Sn="[object Set]",Tn="[object WeakMap]",xn="[object DataView]",An=E(jn),Mn=E(Z),Dn=E(_n),En=E(mn),kn=E(wn),In=p;(jn&&In(new jn(new ArrayBuffer(1)))!=xn||Z&&In(new Z)!=On||_n&&In(_n.resolve())!=$n||mn&&In(new mn)!=Sn||wn&&In(new wn)!=Tn)&&(In=function(t){var e=p(t),r="[object Object]"==e?t.constructor:void 0,n=r?E(r):"";if(n)switch(n){case An:return xn;case Mn:return On;case Dn:return $n;case En:return Sn;case kn:return Tn}return e});var Cn=In,Fn=1,zn="[object Arguments]",Nn="[object Array]",Pn="[object Object]",Wn=Object.prototype.hasOwnProperty;function Ln(t,r,n,o,i,u){var a=e(t),c=e(r),s=a?Nn:Cn(t),f=c?Nn:Cn(r),l=(s=s==zn?Pn:s)==Pn,v=(f=f==zn?Pn:f)==Pn,h=s==f;if(h&&He(t)){if(!He(r))return!1;a=!0,l=!1}if(h&&!l)return u||(u=new ce),a||or(t)?Hr(t,r,n,o,i,u):function(t,e,r,n,o,i,u){switch(r){case un:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case on:return!(t.byteLength!=e.byteLength||!i(new _e(t),new _e(e)));case qr:case Gr:case Xr:return H(+t,+e);case Kr:return t.name==e.name&&t.message==e.message;case tn:case rn:return t==e+"";case Qr:var a=Vr;case en:var c=n&Jr;if(a||(a=Rr),t.size!=e.size&&!c)return!1;var s=u.get(t);if(s)return s==e;n|=Zr,u.set(t,e);var f=Hr(a(t),a(e),n,o,i,u);return u.delete(t),f;case nn:if(cn)return cn.call(t)==cn.call(e)}return!1}(t,r,s,n,o,i,u);if(!(n&Fn)){var p=l&&Wn.call(t,"__wrapped__"),d=v&&Wn.call(r,"__wrapped__");if(p||d){var y=p?t.value():t,b=d?r.value():r;return u||(u=new ce),i(y,b,n,o,u)}}return!!h&&(u||(u=new ce),function(t,e,r,n,o,i){var u=r&bn,a=yn(t),c=a.length;if(c!=yn(e).length&&!u)return!1;for(var s=c;s--;){var f=a[s];if(!(u?f in e:gn.call(e,f)))return!1}var l=i.get(t),v=i.get(e);if(l&&v)return l==e&&v==t;var h=!0;i.set(t,e),i.set(e,t);for(var p=u;++s<c;){var d=t[f=a[s]],y=e[f];if(n)var b=u?n(y,d,f,e,t,i):n(d,y,f,t,e,i);if(!(void 0===b?d===y||o(d,y,r,n,i):b)){h=!1;break}p||(p="constructor"==f)}if(h&&!p){var g=t.constructor,j=e.constructor;g==j||!("constructor"in t)||!("constructor"in e)||"function"==typeof g&&g instanceof g&&"function"==typeof j&&j instanceof j||(h=!1)}return i.delete(t),i.delete(e),h}(t,r,n,o,i,u))}function Un(t,e,r,n,o){return t===e||(null==t||null==e||!d(t)&&!d(e)?t!=t&&e!=e:Ln(t,e,r,n,Un,o))}var Bn=1,Yn=2;function Hn(t){return t==t&&!m(t)}function Vn(t,e){return function(r){return null!=r&&(r[t]===e&&(void 0!==e||t in Object(r)))}}function Rn(t){var e=function(t){for(var e=Fr(t),r=e.length;r--;){var n=e[r],o=t[n];e[r]=[n,o,Hn(o)]}return e}(t);return 1==e.length&&e[0][2]?Vn(e[0][0],e[0][1]):function(r){return r===t||function(t,e,r,n){var o=r.length,i=o,u=!n;if(null==t)return!i;for(t=Object(t);o--;){var a=r[o];if(u&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++o<i;){var c=(a=r[o])[0],s=t[c],f=a[1];if(u&&a[2]){if(void 0===s&&!(c in t))return!1}else{var l=new ce;if(n)var v=n(s,f,c,t,e,l);if(!(void 0===v?Un(f,s,Bn|Yn,n,l):v))return!1}}return!0}(r,t,e)}}function Jn(t,e){return null!=t&&e in Object(t)}function Zn(t,r){return null!=t&&function(t,r,n){for(var o=-1,i=(r=vt(r,t)).length,u=!1;++o<i;){var a=pt(r[o]);if(!(u=null!=t&&n(t,a)))break;t=t[a]}return u||++o!=i?u:!!(i=null==t?0:t.length)&&We(i)&&lr(a,i)&&(e(t)||Ne(t))}(t,r,Jn)}var qn=1,Gn=2;function Kn(t){return function(e){return null==e?void 0:e[t]}}function Qn(t){return _(t)?Kn(pt(t)):function(t){return function(e){return dt(e,t)}}(t)}function Xn(t){return"function"==typeof t?t:null==t?jr:"object"==typeof t?e(t)?(r=t[0],n=t[1],_(r)&&Hn(n)?Vn(pt(r),n):function(t){var e=yt(t,r);return void 0===e&&e===n?Zn(t,r):Un(n,e,qn|Gn)}):Rn(t):Qn(t);var r,n}function to(t,e){var r=-1,n=Le(t)?Array(t.length):[];return Nr(t,(function(t,o,i){n[++r]=e(t,o,i)})),n}var eo=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)sn(e,dn(t)),t=Ae(t);return e}:ln,ro=eo;function no(t){return fn(t,yr,ro)}var oo=Object.prototype.hasOwnProperty;var io=/\w*$/;var uo=i?i.prototype:void 0,ao=uo?uo.valueOf:void 0;var co="[object Boolean]",so="[object Date]",fo="[object Map]",lo="[object Number]",vo="[object RegExp]",ho="[object Set]",po="[object String]",yo="[object Symbol]",bo="[object ArrayBuffer]",go="[object DataView]",jo="[object Float32Array]",_o="[object Float64Array]",mo="[object Int8Array]",wo="[object Int16Array]",Oo="[object Int32Array]",$o="[object Uint8Array]",So="[object Uint8ClampedArray]",To="[object Uint16Array]",xo="[object Uint32Array]";function Ao(t,e,r){var n,o=t.constructor;switch(e){case bo:return me(t);case co:case so:return new o(+t);case go:return function(t,e){var r=e?me(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}(t,r);case jo:case _o:case mo:case wo:case Oo:case $o:case So:case To:case xo:return we(t,r);case fo:return new o;case lo:case po:return new o(t);case vo:return function(t){var e=new t.constructor(t.source,io.exec(t));return e.lastIndex=t.lastIndex,e}(t);case ho:return new o;case yo:return n=t,ao?Object(ao.call(n)):{}}}var Mo=rr&&rr.isMap,Do=Mo?Qe(Mo):function(t){return d(t)&&"[object Map]"==Cn(t)};var Eo=rr&&rr.isSet,ko=Eo?Qe(Eo):function(t){return d(t)&&"[object Set]"==Cn(t)},Io=1,Co=2,Fo=4,zo="[object Arguments]",No="[object Function]",Po="[object GeneratorFunction]",Wo="[object Object]",Lo={};function Uo(t,r,n,o,i,u){var a,c=r&Io,s=r&Co,f=r&Fo;if(n&&(a=i?n(t,o,i,u):n(t)),void 0!==a)return a;if(!m(t))return t;var l=e(t);if(l){if(a=function(t){var e=t.length,r=new t.constructor(e);return e&&"string"==typeof t[0]&&oo.call(t,"index")&&(r.index=t.index,r.input=t.input),r}(t),!c)return Oe(t,a)}else{var v=Cn(t),h=v==No||v==Po;if(He(t))return je(t,c);if(v==Wo||v==zo||h&&!i){if(a=s||h?{}:Ee(t),!c)return s?function(t,e){return cr(t,ro(t),e)}(t,function(t,e){return t&&cr(e,yr(e),t)}(a,t)):function(t,e){return cr(t,dn(t),e)}(t,function(t,e){return t&&cr(e,Fr(e),t)}(a,t))}else{if(!Lo[v])return i?t:{};a=Ao(t,v,c)}}u||(u=new ce);var p=u.get(t);if(p)return p;u.set(t,a),ko(t)?t.forEach((function(e){a.add(Uo(e,r,n,e,t,u))})):Do(t)&&t.forEach((function(e,o){a.set(o,Uo(e,r,n,o,t,u))}));var d=l?void 0:(f?s?no:yn:s?yr:Fr)(t);return Er(d||t,(function(e,o){d&&(e=t[o=e]),ar(a,o,Uo(e,r,n,o,t,u))})),a}Lo[zo]=Lo["[object Array]"]=Lo["[object ArrayBuffer]"]=Lo["[object DataView]"]=Lo["[object Boolean]"]=Lo["[object Date]"]=Lo["[object Float32Array]"]=Lo["[object Float64Array]"]=Lo["[object Int8Array]"]=Lo["[object Int16Array]"]=Lo["[object Int32Array]"]=Lo["[object Map]"]=Lo["[object Number]"]=Lo[Wo]=Lo["[object RegExp]"]=Lo["[object Set]"]=Lo["[object String]"]=Lo["[object Symbol]"]=Lo["[object Uint8Array]"]=Lo["[object Uint8ClampedArray]"]=Lo["[object Uint16Array]"]=Lo["[object Uint32Array]"]=!0,Lo["[object Error]"]=Lo[No]=Lo["[object WeakMap]"]=!1;var Bo=1,Yo=4;function Ho(t){return Uo(t,Bo|Yo)}var Vo="[object String]";var Ro=Kn("length"),Jo=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var Zo="\\ud800-\\udfff",qo="["+Zo+"]",Go="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",Ko="\\ud83c[\\udffb-\\udfff]",Qo="[^"+Zo+"]",Xo="(?:\\ud83c[\\udde6-\\uddff]){2}",ti="[\\ud800-\\udbff][\\udc00-\\udfff]",ei="(?:"+Go+"|"+Ko+")"+"?",ri="[\\ufe0e\\ufe0f]?",ni=ri+ei+("(?:\\u200d(?:"+[Qo,Xo,ti].join("|")+")"+ri+ei+")*"),oi="(?:"+[Qo+Go+"?",Go,Xo,ti,qo].join("|")+")",ii=RegExp(Ko+"(?="+Ko+")|"+oi+ni,"g");function ui(t){return function(t){return Jo.test(t)}(t)?function(t){for(var e=ii.lastIndex=0;ii.test(t);)++e;return e}(t):Ro(t)}var ai="[object Map]",ci="[object Set]";function si(t){if(null==t)return 0;if(Le(t))return"string"==typeof(r=t)||!e(r)&&d(r)&&p(r)==Vo?ui(t):t.length;var r,n=Cn(t);return n==ai||n==ci?t.size:Cr(t).length}function fi(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=jt(),r={},n=null,o=yt(t,"timeAlive");Gt(o)||(o=1e4),o=qt(o);let i=yt(t,"timeDetect");return Gt(i)||(i=50),i=qt(i),e.trigger=function(t,u){wt(t)?(St(r,t)||setTimeout((()=>{e.emit("message",{eventName:"enter",key:t,data:u,now:si(r)})}),1),r[t]={data:u,time:Date.now()},null===n&&(n=setInterval((()=>{Pr(r,((t,n)=>{if(Date.now()-t.time>o){let t=Ho(r[n]);delete r[n],e.emit("message",{eventName:"leave",key:n,data:t.data,now:si(r)})}})),te(r)||(clearInterval(n),n=null)}),i))):console.log("trigger need key")},e.get=function(){let t=[];return Pr(r,((e,r)=>{t.push({key:r,data:e.data})})),t=Ho(t),t},e}function li(t){let r={};if(te(t)||(console.log("instWConverServer is not an effective object, and set instWConverServer to an EventEmitter"),t=jt()),!St(t,"emit"))throw new Error("instWConverServer is not an EventEmitter");let n=function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];setTimeout((()=>{t.emit(e,...n)}),1)},o=fi(),i=setInterval((()=>{let t=o.get(),n=(u="key",(e(i=t)?ut:to)(i,Xn(u)));var i,u;let a={};Pr(n,(t=>{a[t]=yt(r,t,[])})),r=a}),1e3);o.on("message",(function(t){let{eventName:e,key:r,data:o,now:i}=t;"enter"===e?n("clientEnter",r,o):"leave"===e&&n("clientLeave",r,o),n("clientChange",i)})),t.on("execute",(function(t,e,i){if("[sys:polling]"===t)try{let t=yt(e,"clientId",""),n=yt(r,t,[]);n=Ho(n),r[t]=[],o.trigger(t,e),i.resolve(n)}catch(t){n("error",t),i.reject("[sys:polling] error")}}));return t.getClients=o.get,t.getMessages=()=>Ho(r),t.broadcast=t=>{if(!te(r))return;let e={};Pr(r,((r,n)=>{r.push({mode:"broadcast",data:t}),e[n]=r})),r=e},t.clearBroadcast=()=>{clearInterval(i)},t}let vi=(t,e)=>{let r={};return Pr(t,(t=>{let n=t,o=yt(e,t,"");wt(o)&&(r[n]=o)})),r};function hi(t,e,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!te(t))throw new Error("invalid instWConverServer");if(0===si(e))return t;if(!te(r))return t;let o=yt(n,"genTag");At(o)||(o=()=>Mt()+"|"+Xt(6));let i={};return Pr(e,(t=>{i[t]=o()})),t.initTableTags(i,"useInputOnly"),Pr(e,(e=>{let n=r[e];if(!n)throw new Error(`invalid kpOrm[${e}]`);try{n.on("change",(()=>{t.updateTableTag(e)}))}catch(t){throw new Error(`kpOrm[${e}] can not listen to change events`)}})),t.on("changeTableTags",(r=>{t.broadcast({mode:"syncKpTable",data:vi(e,r)})})),t}function pi(t){return"[object Array]"===Object.prototype.toString.call(t)}function di(t){let e,r=Object.prototype.toString.call(t);if(e="[object Promise]"===r,e)return!0;if("[object Function]"!==r)return!1;try{e="function"!=typeof t.subscribe&&"function"==typeof t.then}catch(t){}return e}function yi(t){return t!=t}function bi(t,e,r){return e==e?function(t,e,r){for(var n=r-1,o=t.length;++n<o;)if(t[n]===e)return n;return-1}(t,e,r):function(t,e,r,n){for(var o=t.length,i=r+(n?1:-1);n?i--:++i<o;)if(e(t[i],i,t))return i;return-1}(t,yi,r)}function gi(t,e,r,n){for(var o=r-1,i=t.length;++o<i;)if(n(t[o],e))return o;return-1}var ji=Array.prototype.splice;function _i(t,e){return t&&t.length&&e&&e.length?function(t,e,r,n){var o=n?gi:bi,i=-1,u=e.length,a=t;for(t===e&&(e=Oe(e)),r&&(a=ut(t,Qe(r)));++i<u;)for(var c=0,s=e[i],f=r?r(s):s;(c=o(a,f,c,n))>-1;)a!==t&&ji.call(a,c,1),ji.call(t,c,1);return t}(t,e):t}function mi(t){return!!Mr(t)||(!!function(t){return"[object Null]"===Object.prototype.toString.call(t)}(t)||(!!function(t){if(_t(t)){for(let e in t)return!1;return!0}return!1}(t)||(!!function(t){return!(!mt(t)||""!==t)}(t)||(!!function(t){return!!pi(t)&&0===t.length}(t)||!!Ot(t)))))}function wi(t){return!!pi(t)&&(0!==t.length&&(1!==t.length||!mi(t[0])))}let Oi=function(t){if(!At(t))throw new Error("fn is not a function");return function(){let e=function(){let t,e,r=new Promise((function(){t=arguments[0],e=arguments[1]}));return r.resolve=t,r.reject=e,r}(),r=null,n=null;try{r=t.apply(this,arguments)}catch(t){n=t}return null!==n?e.resolve({state:"error",msg:n}):di(r)?r.then((t=>{e.resolve({state:"success",msg:t})})).catch((t=>{"cancelled"===yt(t,"reason")?e.resolve({state:"cancelled",msg:""}):e.resolve({state:"error",msg:t})})):e.resolve({state:"success",msg:r}),e}};function $i(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!te(t))throw new Error("invalid instWConverServer");let r=yt(e,"getUserIdByToken",null);At(r)||(r=async()=>"");let n=yt(e,"useDbOrm",null);re(n)||(n=!1);let o=null;if(n&&(o=yt(e,"operOrm",null),!At(o)))throw new Error("invalid opt.operOrm when useDbOrm=true");let i=[];if(n&&(i=yt(e,"tableNames",null),!pi(i)))throw new Error("invalid opt.tableNames when useDbOrm=true");let u=[];n&&(u=yt(e,"methods",null),pi(u)||(u=["select","insert","save","del"]));let a=yt(e,"kpFunExt",null);let c={};async function s(t,e,n){if(!wt(t))return n.resolve({state:"error",msg:"invalid func"}),n;let o="";if(!St(e,"__sysToken__"))return n.resolve({state:"error",msg:"invalid token"}),n;if(o=function(t){if(!wt(t)&&!$t(t)&&!b(t))return"";let e="";try{e=String(t)}catch(t){}try{e=t.toString()}catch(t){}return e}(e.__sysToken__),!St(e,"__sysInputArgs__"))return n.resolve({state:"error",msg:"invalid input"}),n;e=e.__sysInputArgs__;let i="";if(i=r(o),di(i)&&(i=await i),wt(i)||(i=""),"[sys:getFuncList]"===t){let t=Fr(c);t=function(t,e){if(!wi(t))return[];if((_t(e)||$t(e)||mt(e)||re(e))&&(e=[e]),!wi(e))return t;let r=Ho(t);return _i(r,e),r}(t,"[sys:getTableTags]");let e={state:"success",msg:t};return n.resolve(e),n}if(!St(c,t))return n.resolve({state:"error",msg:`invalid func[${t}]`}),n;let u=c[t];try{let t=await Oi(u)(i,...e);n.resolve(t)}catch(e){n.resolve({state:"error",msg:`call func[${t}] has an error: ${e.message}`})}return n}return n&&(i=Ho(i),c=function(t,e,r){let n={};return Pr(t,(t=>{Pr(e,(e=>{n[`${t}.${e}`]=async function(n,o){return await r(n,t,e,o)}}))})),n}(i,u,o)),te(a)&&Pr(a,((t,e)=>{c[e]=t})),t.on("execute",(async function(e,r,n){await s(e,r,n).catch((r=>{t.emit("error",r),n.resolve({state:"error",msg:`execFun func[${e}] has an error: ${r.message}`})}))})),t}return function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(te(t)||(console.log("instWConverServer is not an effective object, and set instWConverServer to an EventEmitter"),t=jt()),!St(t,"emit"))throw new Error("instWConverServer is not an EventEmitter");let r=yt(e,"fpTableTags",null);wt(r)||(r="./tableTags.json");let n=yt(e,"genTag");At(n)||(n=()=>Mt()+"|"+Xt(6)),t=new li(t=new Dr(t,{fpTableTags:r,genTag:n}));let o=yt(e,"useDbOrm",null);re(o)||(o=!0);let i=yt(e,"kpOrm",null),u=yt(e,"operOrm",null),a=yt(e,"tableNamesExec",null),c=yt(e,"methodsExec",null),s=yt(e,"tableNamesSync",null),f=yt(e,"getUserIdByToken",null),l=yt(e,"kpFunExt",null);if(te(l)||(l={}),l={...l,"[sys:getTableTags]":()=>{let e=t.getTableTags();return{mode:"syncKpTable",data:vi(s,e)}}},t=new $i(t,{getUserIdByToken:f,useDbOrm:o,operOrm:u,tableNames:a,methods:c,kpFunExt:l}),o){if(!_t(i))return t.emit("error","invalid opt.kpOrm when useDbOrm=true"),t;t=new hi(t,s,i,{genTag:n})}return t}}));
//# sourceMappingURL=w-serv-webdata-server.umd.js.map
